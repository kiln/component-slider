(function(t,e){typeof exports==="object"&&typeof module!=="undefined"?module.exports=e(require("d3")):typeof define==="function"&&define.amd?define(["d3"],e):t.slider=e(t.d3)})(this,function(t){"use strict";var e="1.0.0";function i(e){this.container=t.select(e);this._width=null;this._height=null;this._handleRadius=15;this._channelHeight=5;this._channelRadius=null;this._handleFill="black";this._channelFill="#eee";this._margin={top:null,left:null,right:null};this._transform=null;this._domain=[0,1];this._value=null;this._snap=false;this._scale=null;this._axis=false;this._ticks=null;this._tickFormat=null;this._tickSize=null;this._label=null;this._labelSize=18;this._startLabel=null;this._startLabelBelow=false;this._endLabel=null;this._endLabelBelow=false;this._startEndLabelSize=16;this._infoLink=null;this.handlers={change:[]}}function n(t){if(t.length>0&&t.charAt(0)=="_"){i.prototype[t.substr(1)]=function(e){if(typeof e=="undefined")return this[t];this[t]=e;return this}}}var a=new i;for(var s in a){n(s)}i.prototype.margin=function o(t){if(!t)return this._margin;for(s in t){if(s in this._margin)this._margin[s]=t[s];else throw"Kiln.slider.margin: unrecognised option "+s}return this};i.prototype.on=function u(t,e){if(!(t in this.handlers))throw"Kiln.slider.on: No such event: "+t;this.handlers[t].push(e);return this};i.prototype.fire=function c(t,e){if(!(t in this.handlers))throw"Kiln.slider.fire: No such event: "+t;var i=this.handlers[t];for(var n=0;n<i.length;n++){i[n].call(this,e)}return this};function r(t,e,i,n){if(typeof i==="undefined")i=0;if(typeof n==="undefined")n=t.length;if(n-i==0)return e;if(n-i==1)return t[i];if(n-i==2){var a=Math.abs(t[i]-e),s=Math.abs(t[i+1]-e);if(a<=s)return t[i];else return t[i+1]}var l=i+Math.floor((n-i)/2),h=t[l];pre=l-1,pre_v=t[pre];if(pre_v<=e&&e<=h){return Math.abs(pre_v-e)<=Math.abs(h-e)?pre_v:h}if(h<=e)return r(t,e,l,n);else return r(t,e,i,l)}function l(t,e){if(typeof t=="boolean"){return t?Math.round(e):e}return r(t,e)}i.prototype.draw=function d(){var e=this;var i=this._width,n=this._height;var a=this.container.node();if(!i){var s=a.getBoundingClientRect();if(!s||s.width==0)return this;i=s.width;n=s.height}var r=this._channelRadius||this._channelHeight/2,h=this._margin.left==null?Math.max(this._handleRadius,r):this._margin.left,o=this._margin.right==null?Math.max(this._handleRadius,r):this._margin.right,u=this._margin.top==null?Math.max(this._handleRadius,this._channelHeight/2):this._margin.top,c=i-h-o,d=c+2*r,_=this._labelSize*1.5;if(this._label!=null&&this._margin.top==null)u+=_;var f;if(a.namespaceURI=="http://www.w3.org/2000/svg"){f=this.container}else{f=this.container.selectAll("svg").data([{width:i,height:n}]);f.exit().remove();f=f.enter().append("svg").merge(f);f.attr("width",function(t){return t.width}).attr("height",function(t){return t.height})}var v=f.selectAll("g.slider-container").data([{left:h,top:u,id:this._id}]);v.exit().remove();v=v.enter().append("g").attr("class","slider-container").merge(v);v.attr("transform",function(t){return"translate("+t.left+","+t.top+")"}).attr("id",function(t){return t.id});this.scale=(this._scale?this._scale():t.scaleLinear()).domain(this._domain).range([0,c]);if(this._value==null||this._value<this._domain[0])this._value=this._domain[0];else if(this._value>this._domain[1])this._value=this._domain[1];if(this._snap)this._value=l(this._snap,this._value);var p=[];if(this._axis){var m;if(typeof this._axis!="boolean"){m=this._axis(this.scale)}else{m=t.axisBottom().scale(this.scale).tickPadding(6)}if(this._ticks)m.ticks(this._ticks);if(this._tickFormat)m.tickFormat(this._tickFormat);if(this._tickSize)m.tickSize(this._tickSize);else m.tickSize(Math.max(5,this._handleRadius-this._channelHeight-2));p.push(m)}var g=v.selectAll(".slider-axis");var b=g.data(p).enter();b.append("g").attr("class","slider-axis").attr("transform","translate("+0+","+this._channelHeight/2+")").each(function(e){e(t.select(this))});b.select(".domain").attr("fill","none");b.selectAll(".tick line").attr("stroke","black");b.exit().remove();var x,w;x=v.selectAll(".slider-channel").data([{width:d,height:this._channelHeight,channel_r:r}]);x.exit().remove();x=x.enter().append("rect").attr("class","slider-channel").attr("fill",this._channelFill).attr("cursor","pointer").on("click",function(){var i=Math.max(0,Math.min(c,t.mouse(this)[0]));e._value=e.scale.invert(i);if(e._snap)e._value=l(e._snap,e._value);w.attr("cx",e.scale(e._value));e.fire("change",e._value)}).merge(x);x.attr("width",function(t){return t.width}).attr("height",function(t){return t.height}).attr("y",function(t){return-t.height/2}).attr("x",function(t){return-t.channel_r}).attr("rx",function(t){return t.channel_r});var L,k;function y(t){document.addEventListener("mouseup",z,false);document.addEventListener("mousemove",M,false);L=t.clientX;k=e.scale(e._value)}function z(){document.removeEventListener("mouseup",z,false);document.removeEventListener("mousemove",M,false)}function M(t){var i=t.clientX-L;var n=k+i;var a=Math.max(0,Math.min(c,n));var s=e.scale.invert(a);if(e._snap)s=l(e._snap,s);w.attr("cx",e.scale(s));if(s!=e._value){e._value=s;e.fire("change",e._value)}}w=v.selectAll(".slider-handle").data([{v:this._value,x:this.scale(this._value)}]);w=w.enter().append("circle").attr("class","slider-handle").attr("cursor","col-resize").on("mousedown",function(){t.event.preventDefault();y(t.event)}).merge(w);w.attr("cx",function(t){return t.x}).attr("r",this._handleRadius).attr("fill",this._handleFill);var S=[],R=[];if(this._label){S.push({label:this._label,x:c/2,y:-_,font_size:this._labelSize});if(this._infoLink){R.append({callback:this._infoLink})}}var A=v.selectAll(".slider-label").data(S);A.exit().remove();A=A.enter().append("text").attr("class","slider-label").attr("text-anchor","middle").attr("cursor","default").merge(A);A.text(function(t){return t.label}).attr("x",function(t){return t.x}).attr("y",function(t){return t.y}).attr("font-size",this._labelSize);var B=A.selectAll("tspan").data(R);B.enter().append("tspan").text(" ÔÅö").attr("class","info-sign").on("click",this._infoLink);B.exit().remove();var E=[];if(this._startLabel){E.push({label:this._startLabel,x:this._startLabelBelow?0:-(r+5+Math.max(0,this._handleRadius-r)),y:this._startLabelBelow?r+15:this._startEndLabelSize/1.75-r/2,anchor:this._startLabelBelow?"middle":"end",font_size:this._startEndLabelSize})}if(this._endLabel){E.push({label:this._endLabel,x:this._endLabelBelow?c:c+(r+Math.max(0,this._handleRadius-r)+5),y:this._startLabelBelow?r+15:this._startEndLabelSize/1.75-r/2,anchor:this._endLabelBelow?"middle":"start",font_size:this._startEndLabelSize})}var F=v.selectAll(".slider-end-labels").data(E);F.exit().remove();F=F.enter().append("text").attr("class","slider-end-labels").attr("pointer-events","none").merge(F);F.text(function(t){return t.label}).attr("font-size",function(t){return t.font_size}).attr("x",function(t){return t.x}).attr("y",function(t){return t.y}).attr("text-anchor",function(t){return t.anchor});return this};i.prototype.update=i.prototype.draw;function h(t){return new i(t)}h.version=e;return h});
(function(t,e){typeof exports==="object"&&typeof module!=="undefined"?module.exports=e(require("d3-selection"),require("d3-axis"),require("d3-scale")):typeof define==="function"&&define.amd?define(["d3-selection","d3-axis","d3-scale"],e):t.slider=e(t.d3,t.d3,t.d3)})(this,function(t,e,i){"use strict";var n="1.0.0";function a(e){this.container=t.select(e);this._width=null;this._height=null;this._handleRadius=15;this._channelHeight=5;this._channelRadius=null;this._handleFill="black";this._channelFill="#eee";this._margin={top:null,left:null,right:null};this._transform=null;this._domain=[0,1];this._value=null;this._snap=false;this._scale=null;this._axis=false;this._ticks=null;this._tickFormat=null;this._tickSize=null;this._label=null;this._labelSize=18;this._startLabel=null;this._startLabelBelow=false;this._endLabel=null;this._endLabelBelow=false;this._startEndLabelSize=16;this._infoLink=null;this.handlers={change:[]}}function s(t){if(t.length>0&&t.charAt(0)=="_"){a.prototype[t.substr(1)]=function(e){if(typeof e=="undefined")return this[t];this[t]=e;return this}}}var r=new a;for(var l in r){s(l)}a.prototype.margin=function c(t){if(!t)return this._margin;for(l in t){if(l in this._margin)this._margin[l]=t[l];else throw"Kiln.slider.margin: unrecognised option "+l}return this};a.prototype.on=function d(t,e){if(!(t in this.handlers))throw"Kiln.slider.on: No such event: "+t;this.handlers[t].push(e);return this};a.prototype.fire=function _(t,e){if(!(t in this.handlers))throw"Kiln.slider.fire: No such event: "+t;var i=this.handlers[t];for(var n=0;n<i.length;n++){i[n].call(this,e)}return this};function h(t,e,i,n){if(typeof i==="undefined")i=0;if(typeof n==="undefined")n=t.length;if(n-i==0)return e;if(n-i==1)return t[i];if(n-i==2){var a=Math.abs(t[i]-e),s=Math.abs(t[i+1]-e);if(a<=s)return t[i];else return t[i+1]}var r=i+Math.floor((n-i)/2),l=t[r];pre=r-1,pre_v=t[pre];if(pre_v<=e&&e<=l){return Math.abs(pre_v-e)<=Math.abs(l-e)?pre_v:l}if(l<=e)return h(t,e,r,n);else return h(t,e,i,r)}function o(t,e){if(typeof t=="boolean"){return t?Math.round(e):e}return h(t,e)}a.prototype.draw=function f(){var n=this;var a=this._width,s=this._height;var r=this.container.node();if(!a){var l=r.getBoundingClientRect();if(!l||l.width==0)return this;a=l.width;s=l.height}var h=this._channelRadius||this._channelHeight/2,u=this._margin.left==null?Math.max(this._handleRadius,h):this._margin.left,c=this._margin.right==null?Math.max(this._handleRadius,h):this._margin.right,d=this._margin.top==null?Math.max(this._handleRadius,this._channelHeight/2):this._margin.top,_=a-u-c,f=_+2*h,v=this._labelSize*1.5;if(this._label!=null&&this._margin.top==null)d+=v;var p;if(r.namespaceURI=="http://www.w3.org/2000/svg"){p=this.container}else{p=this.container.selectAll("svg").data([{width:a,height:s}]);p.exit().remove();p=p.enter().append("svg").merge(p);p.attr("width",function(t){return t.width}).attr("height",function(t){return t.height})}var m=p.selectAll("g.slider-container").data([{left:u,top:d,id:this._id}]);m.exit().remove();m=m.enter().append("g").attr("class","slider-container").merge(m);m.attr("transform",function(t){return"translate("+t.left+","+t.top+")"}).attr("id",function(t){return t.id});this.scale=(this._scale?this._scale():i.scaleLinear()).domain(this._domain).range([0,_]);if(this._value==null||this._value<this._domain[0])this._value=this._domain[0];else if(this._value>this._domain[1])this._value=this._domain[1];if(this._snap)this._value=o(this._snap,this._value);var g=[];if(this._axis){var b;if(typeof this._axis!="boolean"){b=this._axis(this.scale)}else{b=e.axisBottom().scale(this.scale).tickPadding(6)}if(this._ticks)b.ticks(this._ticks);if(this._tickFormat)b.tickFormat(this._tickFormat);if(this._tickSize)b.tickSize(this._tickSize);else b.tickSize(Math.max(5,this._handleRadius-this._channelHeight-2));g.push(b)}var x=m.selectAll(".slider-axis");var w=x.data(g).enter();w.append("g").attr("class","slider-axis").attr("transform","translate("+0+","+this._channelHeight/2+")").each(function(e){e(t.select(this))});w.select(".domain").attr("fill","none");w.selectAll(".tick line").attr("stroke","black");w.exit().remove();var L,k;L=m.selectAll(".slider-channel").data([{width:f,height:this._channelHeight,channel_r:h}]);L.exit().remove();L=L.enter().append("rect").attr("class","slider-channel").attr("fill",this._channelFill).attr("cursor","pointer").on("click",function(){var e=Math.max(0,Math.min(_,t.mouse(this)[0]));n._value=n.scale.invert(e);if(n._snap)n._value=o(n._snap,n._value);k.attr("cx",n.scale(n._value));n.fire("change",n._value)}).merge(L);L.attr("width",function(t){return t.width}).attr("height",function(t){return t.height}).attr("y",function(t){return-t.height/2}).attr("x",function(t){return-t.channel_r}).attr("rx",function(t){return t.channel_r});var y,z;function M(t){document.addEventListener("mouseup",S,false);document.addEventListener("mousemove",R,false);y=t.clientX;z=n.scale(n._value)}function S(){document.removeEventListener("mouseup",S,false);document.removeEventListener("mousemove",R,false)}function R(t){var e=t.clientX-y;var i=z+e;var a=Math.max(0,Math.min(_,i));var s=n.scale.invert(a);if(n._snap)s=o(n._snap,s);k.attr("cx",n.scale(s));if(s!=n._value){n._value=s;n.fire("change",n._value)}}k=m.selectAll(".slider-handle").data([{v:this._value,x:this.scale(this._value)}]);k=k.enter().append("circle").attr("class","slider-handle").attr("cursor","col-resize").on("mousedown",function(){t.event.preventDefault();M(t.event)}).merge(k);k.attr("cx",function(t){return t.x}).attr("r",this._handleRadius).attr("fill",this._handleFill);var A=[],B=[];if(this._label){A.push({label:this._label,x:_/2,y:-v,font_size:this._labelSize});if(this._infoLink){B.append({callback:this._infoLink})}}var E=m.selectAll(".slider-label").data(A);E.exit().remove();E=E.enter().append("text").attr("class","slider-label").attr("text-anchor","middle").attr("cursor","default").merge(E);E.text(function(t){return t.label}).attr("x",function(t){return t.x}).attr("y",function(t){return t.y}).attr("font-size",this._labelSize);var F=E.selectAll("tspan").data(B);F.enter().append("tspan").text(" ÔÅö").attr("class","info-sign").on("click",this._infoLink);F.exit().remove();var H=[];if(this._startLabel){H.push({label:this._startLabel,x:this._startLabelBelow?0:-(h+5+Math.max(0,this._handleRadius-h)),y:this._startLabelBelow?h+15:this._startEndLabelSize/1.75-h/2,anchor:this._startLabelBelow?"middle":"end",font_size:this._startEndLabelSize})}if(this._endLabel){H.push({label:this._endLabel,x:this._endLabelBelow?_:_+(h+Math.max(0,this._handleRadius-h)+5),y:this._startLabelBelow?h+15:this._startEndLabelSize/1.75-h/2,anchor:this._endLabelBelow?"middle":"start",font_size:this._startEndLabelSize})}var q=m.selectAll(".slider-end-labels").data(H);q.exit().remove();q=q.enter().append("text").attr("class","slider-end-labels").attr("pointer-events","none").merge(q);q.text(function(t){return t.label}).attr("font-size",function(t){return t.font_size}).attr("x",function(t){return t.x}).attr("y",function(t){return t.y}).attr("text-anchor",function(t){return t.anchor});return this};a.prototype.update=a.prototype.draw;function u(t){return new a(t)}u.version=n;return u});